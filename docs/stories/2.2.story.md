# Story 2.2: 노트 목록 조회 및 페이지네이션

## Status

Ready for Review

---

## Story

**As a** 사용자,  
**I want** 내가 작성한 모든 노트를 목록으로 보고 싶다,  
**so that** 저장한 노트들을 쉽게 찾아보고 관리할 수 있다.

---

## Acceptance Criteria

1. 인증된 사용자의 노트 목록이 `/notes` 페이지에 표시되어야 한다
   - 사용자 본인의 노트만 표시 (user_id 필터링)
   - 최신순 정렬 (created_at 내림차순)
2. 각 노트 카드는 다음 정보를 표시해야 한다
   - 노트 제목
   - 본문 미리보기 (최대 150자, 말줄임표 처리)
   - 작성일시 (상대 시간 표시: "5분 전", "2시간 전", "2일 전" 등)
3. 노트 카드 클릭 시 노트 상세 페이지로 이동해야 한다
4. 페이지네이션이 구현되어야 한다
   - 한 페이지당 20개 노트 표시
   - "이전" / "다음" 버튼 또는 페이지 번호 표시
   - 현재 페이지 번호 및 전체 페이지 수 표시
5. 노트가 없을 때 빈 상태 UI를 표시해야 한다
   - "아직 노트가 없습니다" 메시지
   - "첫 노트 작성하기" 버튼
6. 로딩 상태를 표시해야 한다
   - 노트 목록 로딩 중 스켈레톤 UI 또는 로딩 스피너
7. 데이터 로딩 실패 시 에러 메시지를 표시해야 한다
8. 목록은 반응형으로 구현되어야 한다
   - 모바일: 1열 그리드
   - 태블릿: 2열 그리드
   - 데스크톱: 3열 그리드

---

## Tasks / Subtasks

- [x] Task 1: 노트 목록 조회 Server Action 구현 (AC: 1, 4)
  - [x] `/app/notes/actions.ts`에 `getNotes` 함수 추가
  - [x] 인증 사용자 확인 (getUser)
  - [x] Drizzle ORM으로 notes 조회
    - [x] user_id 필터링
    - [x] created_at 내림차순 정렬
    - [x] 페이지네이션 적용 (LIMIT, OFFSET)
  - [x] 페이지네이션 메타데이터 반환
    - [x] 전체 노트 개수
    - [x] 현재 페이지
    - [x] 전체 페이지 수
  - [x] 타입 정의 (GetNotesResult)

- [x] Task 2: 노트 카드 컴포넌트 구현 (AC: 2, 3)
  - [x] `/app/notes/note-card.tsx` 생성 (Client Component)
  - [x] 노트 제목 표시
  - [x] 본문 미리보기 (150자 제한, 말줄임표)
  - [x] 작성일시 상대 시간 표시
    - [x] date-fns 또는 유사 라이브러리 사용
    - [x] "방금 전", "5분 전", "2시간 전", "2일 전" 등
  - [x] 카드 클릭 핸들러 (노트 상세 페이지로 이동)
  - [x] 호버 효과 및 애니메이션

- [x] Task 3: 노트 목록 페이지 업데이트 (AC: 1, 5, 6, 7, 8)
  - [x] `/app/notes/page.tsx` 업데이트
  - [x] getNotes Server Action 호출
  - [x] 노트 목록 그리드 레이아웃 구현
    - [x] Tailwind CSS 반응형 그리드
    - [x] 모바일: 1열, 태블릿: 2열, 데스크톱: 3열
  - [x] 노트 카드 렌더링
  - [x] 빈 상태 UI (노트가 없을 때)
  - [x] 로딩 상태 UI (Suspense 또는 로딩 플래그)
  - [x] 에러 상태 UI

- [x] Task 4: 페이지네이션 컴포넌트 구현 (AC: 4)
  - [x] `/app/notes/pagination.tsx` 생성 (Client Component)
  - [x] "이전" / "다음" 버튼
  - [x] 페이지 번호 표시
  - [x] 현재 페이지 하이라이트
  - [x] 버튼 비활성화 (첫 페이지/마지막 페이지)
  - [x] 페이지 변경 핸들러 (URL 쿼리 파라미터 업데이트)

- [x] Task 5: URL 쿼리 파라미터 처리 (AC: 4)
  - [x] `/app/notes/page.tsx`에서 searchParams 읽기
  - [x] `page` 파라미터 파싱 (기본값: 1)
  - [x] 유효성 검증 (숫자, 양수)
  - [x] 페이지 변경 시 URL 업데이트

- [x] Task 6: 스켈레톤 로딩 UI 구현 (AC: 6)
  - [x] `/app/notes/note-card-skeleton.tsx` 생성
  - [x] 노트 카드 모양의 스켈레톤 컴포넌트
  - [x] Suspense와 함께 사용

- [x] Task 7: 본문 미리보기 유틸리티 함수 (AC: 2)
  - [x] `/lib/utils.ts`에 `truncateText` 함수 추가
  - [x] 150자 제한 및 말줄임표 처리
  - [x] 줄바꿈 제거 또는 공백으로 변환

- [x] Task 8: 테스트 작성
  - [x] `/app/notes/actions.test.ts`에 getNotes 테스트 추가
    - [x] 인증 사용자의 노트만 조회
    - [x] 페이지네이션 동작 검증
    - [x] 정렬 순서 검증
  - [x] `/lib/__tests__/utils.test.ts` 생성
    - [x] truncateText 함수 테스트
    - [x] 미리보기 텍스트 트렁케이션 테스트

---

## Dev Notes

### 이전 스토리 인사이트

[Source: docs/stories/2.1.story.md]
- 노트 생성 기능 완료 (`createNote` Server Action)
- `/app/notes/page.tsx`에 빈 상태 UI가 임시로 구현됨 → 이 스토리에서 실제 목록으로 교체
- `app/notes/actions.ts` 파일 이미 존재
- Drizzle ORM 및 notes 테이블 스키마 사용 가능
- Toast 알림 시스템 (`Sonner`) 이미 설정됨

### 기술 스택

[Source: docs/architecture.md#1-기술-스택]
- **프레임워크**: Next.js (App Router, Server Actions)
- **UI**: shadcn/ui + Tailwind CSS + Radix UI
- **DB/인증**: Supabase (Postgres, Auth)
- **ORM**: Drizzle ORM

### 데이터 모델 (notes 테이블)

[Source: drizzle/schema.ts, docs/architecture.md#2-데이터-모델]
- **notes 테이블 스키마**:
  - `id`: UUID, primary key
  - `user_id`: UUID, not null
  - `title`: text, not null
  - `content`: text, not null
  - `created_at`: timestamp, 기본값 now()
  - `updated_at`: timestamp, 기본값 now()
- **인덱스**: user_id, created_at
- **TypeScript 타입**: `Note`, `NewNote`

### 페이지네이션 전략

- 한 페이지당 20개 노트 표시
- OFFSET 기반 페이지네이션 사용 (간단하고 충분)
  - `LIMIT 20 OFFSET (page - 1) * 20`
- 향후 성능 개선이 필요하면 커서 기반 페이지네이션으로 전환 고려

### 상대 시간 표시

- `date-fns` 라이브러리 사용 추천
  - `formatDistanceToNow` 함수 활용
  - 한국어 locale 지원
- 예시: "방금 전", "5분 전", "2시간 전", "2일 전", "2025년 1월 10일"

### 프로젝트 구조

[Source: project layout]
- **노트 관련 페이지**: `/app/notes/` 디렉토리
  - `/app/notes/page.tsx` - 노트 목록 페이지 (업데이트)
  - `/app/notes/note-card.tsx` - 노트 카드 컴포넌트 (새로 생성)
  - `/app/notes/pagination.tsx` - 페이지네이션 컴포넌트 (새로 생성)
- **Server Actions**: `/app/notes/actions.ts` (getNotes 추가)
- **유틸리티**: `/lib/utils.ts` (truncateText 추가)

### UI 컴포넌트

[Source: project layout, 프로젝트 규칙]
- **shadcn/ui 컴포넌트 사용**:
  - `Button` (`/components/ui/button.tsx`)
  - `Card` (`/components/ui/card.tsx`)
  - `Skeleton` (필요 시 추가)
- **Tailwind CSS**로 반응형 그리드 구현

### 보안 및 권한

[Source: docs/architecture.md#3-보안]
- **권한 스코프**: 모든 노트 쿼리는 user_id로 필터링하여 소유자만 조회 가능
- **인증**: Supabase Auth 사용 (`getUser`로 현재 사용자 확인)
- 비인증 사용자는 middleware에서 이미 차단됨

### 성능 고려사항

- 노트 목록 조회는 인덱스 활용 (user_id, created_at)
- 페이지당 20개로 제한하여 초기 로딩 최적화
- Suspense 사용하여 로딩 상태 개선

### 파일 길이 제한

[Source: 프로젝트 규칙]
- 모든 파일은 **500 LOC 이하** 유지
- 파일은 모듈화되고 단일 목적을 가져야 함

### 주석 규칙

[Source: 프로젝트 규칙]
- 모든 파일은 **4줄의 헤더 주석**으로 시작:
  1. 코드베이스 내 정확한 파일 위치
  2. 이 파일이 무엇을 하는지 설명
  3. 이 파일이 왜 존재하는지 설명
  4. 관련된 2~4개 파일 목록

### 반응형 그리드 예시

```tsx
// Tailwind CSS 반응형 그리드
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {notes.map(note => <NoteCard key={note.id} note={note} />)}
</div>
```

### URL 쿼리 파라미터

- Next.js App Router에서 searchParams 사용
- 예: `/notes?page=2`
- Server Component에서 직접 읽기 가능

---

## Testing

### 테스트 표준

[Source: 프로젝트 규칙]
- **테스트 프레임워크**: Vitest
- **테스트 파일 위치**: `__tests__/` 디렉토리 또는 동일 위치에 `.test.ts`
- **테스트 커버리지 목표**: 80% 이상

### 테스트 항목

1. **Server Action 테스트** (`/app/notes/actions.test.ts`에 추가)
   - `getNotes` 함수 유닛 테스트
   - 인증된 사용자의 노트만 조회하는지 확인
   - 페이지네이션이 올바르게 동작하는지 확인
   - 정렬 순서가 올바른지 확인 (최신순)
   - 비인증 사용자는 노트 조회 실패

2. **노트 카드 컴포넌트 테스트** (`/app/notes/__tests__/note-card.test.tsx`)
   - 노트 카드가 올바르게 렌더링되는지 확인
   - 제목, 미리보기, 작성일시가 표시되는지 확인
   - 본문이 150자로 트렁케이션되는지 확인
   - 카드 클릭 시 올바른 페이지로 이동하는지 확인

3. **페이지네이션 컴포넌트 테스트** (`/app/notes/__tests__/pagination.test.tsx`)
   - 페이지네이션 버튼이 올바르게 렌더링되는지 확인
   - 첫 페이지/마지막 페이지에서 버튼이 비활성화되는지 확인
   - 페이지 변경 시 올바른 URL로 이동하는지 확인

4. **유틸리티 함수 테스트** (`/lib/__tests__/utils.test.ts`에 추가)
   - `truncateText` 함수 테스트
   - 150자 이하 텍스트는 그대로 반환
   - 150자 초과 텍스트는 말줄임표 추가

---

## Change Log

| Date       | Version | Description              | Author     |
|------------|---------|--------------------------|------------|
| 2025-10-14 | 1.0     | Story 2.2 초안 작성      | Bob (SM)   |
| 2025-10-14 | 2.0     | Story 2.2 개발 완료      | James (Dev)|

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (2025-10-14)

### Debug Log References

없음

### Completion Notes List

1. **date-fns 라이브러리 설치**
   - 상대 시간 표시를 위해 date-fns 4.1.0 설치
   - `formatDistanceToNow` 함수와 한국어 locale 사용

2. **Skeleton 컴포넌트 추가**
   - shadcn/ui에서 Skeleton 컴포넌트 추가 (`components/ui/skeleton.tsx`)
   - 노트 목록 로딩 상태 시각화

3. **유틸리티 함수 구현**
   - `lib/utils.ts`에 `truncateText` 함수 추가
   - 150자 제한, 줄바꿈 제거, 말줄임표 처리
   - 8개 테스트 작성 및 통과

4. **getNotes Server Action 구현**
   - `app/notes/actions.ts`에 노트 목록 조회 함수 추가
   - OFFSET 기반 페이지네이션 (페이지당 20개)
   - user_id 필터링 및 created_at 내림차순 정렬
   - 페이지네이션 메타데이터 반환 (currentPage, totalPages, totalNotes)
   - 4개 테스트 작성 및 통과

5. **노트 카드 컴포넌트 구현**
   - `app/notes/note-card.tsx` 생성 (Client Component)
   - 제목, 본문 미리보기, 상대 시간 표시
   - date-fns로 "5분 전", "2시간 전" 등 한국어 상대 시간
   - 호버 효과 및 클릭 시 상세 페이지 이동

6. **스켈레톤 로딩 UI 구현**
   - `app/notes/note-card-skeleton.tsx` 생성
   - 노트 카드와 동일한 모양의 스켈레톤
   - `NoteListSkeleton` 컴포넌트로 6개 카드 표시

7. **페이지네이션 컴포넌트 구현**
   - `app/notes/pagination.tsx` 생성 (Client Component)
   - 이전/다음 버튼 및 페이지 번호 표시
   - 현재 페이지 하이라이트
   - URL 쿼리 파라미터로 페이지 변경
   - 첫/마지막 페이지에서 버튼 비활성화

8. **노트 목록 페이지 업데이트**
   - `app/notes/page.tsx` 완전히 재작성
   - Suspense를 사용한 로딩 상태 처리
   - searchParams로 페이지 번호 읽기
   - 반응형 그리드 (모바일: 1열, 태블릿: 2열, 데스크톱: 3열)
   - 빈 상태, 로딩 상태, 에러 상태 UI 모두 구현

9. **테스트 작성 및 검증**
   - getNotes Server Action 테스트 4개 추가
   - truncateText 유틸리티 함수 테스트 8개 추가
   - 전체 테스트 스위트 93/93 통과
   - 회귀 테스트 통과 확인

### File List

**Created Files:**
- `app/notes/note-card.tsx` - 노트 카드 컴포넌트
- `app/notes/note-card-skeleton.tsx` - 스켈레톤 로딩 UI
- `app/notes/pagination.tsx` - 페이지네이션 컴포넌트
- `lib/__tests__/utils.test.ts` - utils 함수 테스트
- `components/ui/skeleton.tsx` - shadcn/ui Skeleton 컴포넌트

**Modified Files:**
- `app/notes/actions.ts` - getNotes Server Action 추가
- `app/notes/page.tsx` - 노트 목록 조회 및 페이지네이션 구현
- `lib/utils.ts` - truncateText 함수 추가
- `app/notes/actions.test.ts` - getNotes 테스트 추가
- `package.json` - date-fns 의존성 추가

---

## QA Results

_(QA 에이전트가 검토 후 작성)_

