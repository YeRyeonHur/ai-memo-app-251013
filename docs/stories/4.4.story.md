# Story 4.4: AI 처리 상태 UI 구현

## Status

Draft

---

## Story

**As a** 사용자,  
**I want** 노트 상세 페이지에서 AI 요약 및 태그를 확인하고, 생성 버튼을 클릭하여 AI 처리를 요청할 수 있기를 원한다,  
**so that** AI가 처리 중인지, 완료되었는지, 에러가 발생했는지 명확히 알 수 있고, 편리하게 AI 기능을 사용할 수 있다.

---

## Acceptance Criteria

1. 노트 상세 페이지에 AI 섹션이 추가되어야 한다
   - 요약 표시 영역
   - 태그 표시 영역
   - 요약/태그 생성 버튼
   - 섹션은 노트 내용 하단에 위치

2. 요약 표시 UI가 구현되어야 한다
   - 요약이 있으면: 불릿 포인트 형태로 표시
   - 요약이 없으면: "요약 없음" 안내 메시지 + 생성 버튼
   - 생성일시 표시
   - 재생성 버튼 (요약이 있을 때만)

3. 태그 표시 UI가 구현되어야 한다
   - 태그가 있으면: 뱃지 형태로 표시
   - 태그가 없으면: "태그 없음" 안내 메시지 + 생성 버튼
   - 각 태그는 클릭 가능 (향후 검색 기능과 연동 예정)
   - 태그 색상: primary 또는 secondary

4. AI 처리 로딩 상태가 표시되어야 한다
   - 로딩 중일 때: 스피너 아이콘 + "처리 중..." 메시지
   - 버튼 비활성화 (중복 요청 방지)
   - 진행 상황 표시 (예: "요약 생성 중...", "태그 생성 중...")
   - 로딩 상태는 최대 15초 (타임아웃)

5. AI 처리 완료 상태가 표시되어야 한다
   - 성공 메시지: "요약이 생성되었습니다" (토스트 알림)
   - 자동으로 요약/태그 표시 영역 업데이트
   - 버튼 텍스트 변경: "생성" → "재생성"

6. AI 처리 에러 상태가 표시되어야 한다
   - 에러 메시지: 사용자 친화적인 한국어 메시지
   - 에러 타입별 메시지:
     - 네트워크 에러: "네트워크 연결을 확인해주세요"
     - 타임아웃: "처리 시간이 초과되었습니다. 다시 시도해주세요"
     - 권한 에러: "접근 권한이 없습니다"
     - 기타: "요약 생성 중 오류가 발생했습니다"
   - 재시도 버튼 표시
   - 에러 알림은 토스트 메시지로 표시

7. 버튼 UI가 구현되어야 한다
   - 요약 생성 버튼: "요약 생성" 또는 "요약 재생성"
   - 태그 생성 버튼: "태그 생성" 또는 "태그 재생성"
   - 전체 AI 생성 버튼: "AI 요약 및 태그 생성" (요약+태그 한번에)
   - 버튼 스타일: shadcn/ui Button 컴포넌트 사용
   - 로딩 중일 때 버튼 비활성화

8. 반응형 디자인이 적용되어야 한다
   - 모바일: 요약과 태그를 세로로 배치
   - 데스크톱: 요약과 태그를 가로로 배치 (Grid 레이아웃)
   - 버튼은 항상 명확히 보이도록 배치

9. 접근성이 고려되어야 한다
   - 로딩 상태는 스크린 리더에서 읽힘
   - 버튼에 적절한 aria-label 추가
   - 키보드 네비게이션 지원

---

## Tasks / Subtasks

- [ ] Task 1: AI 섹션 컴포넌트 구조 설계 (AC: 1)
  - [ ] `app/notes/[id]/ai-section.tsx` 컴포넌트 생성
  - [ ] 컴포넌트 구조:
    - [ ] AiSection (부모 컴포넌트)
    - [ ] SummaryDisplay (요약 표시)
    - [ ] TagsDisplay (태그 표시)
    - [ ] GenerateButtons (생성 버튼들)
  - [ ] 레이아웃 설계
    - [ ] Grid 레이아웃 (모바일: 1열, 데스크톱: 2열)
    - [ ] 카드 형태로 요약/태그 구분
  - [ ] TypeScript 인터페이스 정의
    - [ ] AiSectionProps
    - [ ] SummaryDisplayProps
    - [ ] TagsDisplayProps

- [ ] Task 2: 요약 표시 컴포넌트 구현 (AC: 2)
  - [ ] `app/notes/[id]/summary-display.tsx` 생성
  - [ ] getSummary Server Action 호출
  - [ ] 요약 있음 상태:
    - [ ] 불릿 포인트 파싱 (줄바꿈 기준)
    - [ ] 각 불릿을 리스트 아이템으로 표시
    - [ ] 생성일시 표시 (상대 시간, 예: "5분 전")
    - [ ] 재생성 버튼 표시
  - [ ] 요약 없음 상태:
    - [ ] 빈 상태 메시지
    - [ ] "요약 생성" 버튼
  - [ ] shadcn/ui Card 컴포넌트 사용
  - [ ] 스타일링: Tailwind CSS

- [ ] Task 3: 태그 표시 컴포넌트 구현 (AC: 3)
  - [ ] `app/notes/[id]/tags-display.tsx` 생성
  - [ ] getTags Server Action 호출
  - [ ] 태그 있음 상태:
    - [ ] 각 태그를 Badge 컴포넌트로 표시
    - [ ] 태그 클릭 시 향후 검색 기능 준비 (현재는 비활성)
    - [ ] Flexbox로 태그 나열
  - [ ] 태그 없음 상태:
    - [ ] 빈 상태 메시지
    - [ ] "태그 생성" 버튼
  - [ ] shadcn/ui Card, Badge 컴포넌트 사용
  - [ ] 스타일링: Tailwind CSS

- [ ] Task 4: 생성 버튼 컴포넌트 구현 (AC: 7)
  - [ ] `app/notes/[id]/generate-buttons.tsx` 생성
  - [ ] 버튼 종류:
    - [ ] 요약 생성 버튼
    - [ ] 태그 생성 버튼
    - [ ] 전체 생성 버튼 (요약+태그)
  - [ ] 버튼 상태 관리
    - [ ] isGeneratingSummary (요약 생성 중)
    - [ ] isGeneratingTags (태그 생성 중)
    - [ ] isGeneratingAll (전체 생성 중)
  - [ ] 버튼 클릭 핸들러
    - [ ] handleGenerateSummary
    - [ ] handleGenerateTags
    - [ ] handleGenerateAll
  - [ ] shadcn/ui Button 컴포넌트 사용
  - [ ] 로딩 중일 때 버튼 비활성화

- [ ] Task 5: 로딩 상태 UI 구현 (AC: 4)
  - [ ] useState로 로딩 상태 관리
    - [ ] isLoading: boolean
    - [ ] loadingMessage: string
  - [ ] 로딩 스피너 표시
    - [ ] shadcn/ui Spinner 또는 Loader 아이콘
    - [ ] 로딩 메시지: "요약 생성 중...", "태그 생성 중..."
  - [ ] 버튼 비활성화
    - [ ] disabled={isLoading}
  - [ ] 타임아웃 처리
    - [ ] 15초 후 자동 에러 처리
    - [ ] setTimeout 사용

- [ ] Task 6: 성공 상태 UI 구현 (AC: 5)
  - [ ] Server Action 성공 시:
    - [ ] 토스트 알림 표시 (shadcn/ui Sonner)
    - [ ] "요약이 생성되었습니다" 메시지
    - [ ] 자동으로 데이터 리프레시
    - [ ] 버튼 텍스트 업데이트
  - [ ] revalidatePath로 자동 업데이트 (Server Action에서 처리됨)
  - [ ] 애니메이션 효과 (fade-in)

- [ ] Task 7: 에러 상태 UI 구현 (AC: 6)
  - [ ] Server Action 에러 시:
    - [ ] 토스트 알림 표시 (shadcn/ui Sonner)
    - [ ] 에러 메시지 표시
    - [ ] 에러 타입별 메시지 매핑
  - [ ] 재시도 버튼 표시
    - [ ] "다시 시도" 버튼
    - [ ] 동일한 액션 재실행
  - [ ] 에러 로깅 (console.error)
  - [ ] 사용자 친화적 메시지

- [ ] Task 8: 노트 상세 페이지 통합 (AC: 1)
  - [ ] `app/notes/[id]/page.tsx`에 AI 섹션 추가
  - [ ] AI 섹션은 노트 내용 하단에 배치
  - [ ] 섹션 제목: "✨ AI 요약 및 태그"
  - [ ] 구분선 추가 (Separator 컴포넌트)
  - [ ] noteId를 props로 전달

- [ ] Task 9: 반응형 디자인 구현 (AC: 8)
  - [ ] Tailwind CSS 반응형 클래스 사용
  - [ ] 모바일: `grid-cols-1`
  - [ ] 태블릿: `md:grid-cols-2`
  - [ ] 데스크톱: `lg:grid-cols-2`
  - [ ] 버튼 배치: 모바일에서는 세로 스택, 데스크톱에서는 가로 배치

- [ ] Task 10: 접근성 구현 (AC: 9)
  - [ ] 로딩 상태에 aria-live="polite" 추가
  - [ ] 버튼에 aria-label 추가
    - [ ] "요약 생성" → aria-label="AI로 노트 요약 생성"
  - [ ] 키보드 네비게이션 테스트
    - [ ] Tab 키로 모든 버튼 접근 가능
    - [ ] Enter/Space로 버튼 클릭 가능
  - [ ] 스크린 리더 테스트

- [ ] Task 11: 컴포넌트 테스트 (선택사항)
  - [ ] `app/notes/[id]/__tests__/ai-section.test.tsx` 생성
  - [ ] 렌더링 테스트
    - [ ] 요약 있을 때 표시 확인
    - [ ] 요약 없을 때 빈 상태 확인
    - [ ] 태그 있을 때 표시 확인
    - [ ] 태그 없을 때 빈 상태 확인
  - [ ] 버튼 클릭 테스트
    - [ ] 요약 생성 버튼 클릭
    - [ ] 태그 생성 버튼 클릭
  - [ ] 로딩 상태 테스트
  - [ ] 에러 상태 테스트
  - [ ] React Testing Library 사용

- [ ] Task 12: 문서화 및 스타일 가이드
  - [ ] 컴포넌트 파일에 JSDoc 주석 추가
  - [ ] 각 컴포넌트의 props 설명
  - [ ] 사용 예시 작성
  - [ ] Storybook 스토리 작성 (선택사항)

---

## Dev Notes

### 기술 스택 및 아키텍처 정보

#### UI 컴포넌트 라이브러리

**shadcn/ui 컴포넌트 사용**:
- Card: 요약/태그 카드 레이아웃
- Button: 생성/재생성 버튼
- Badge: 태그 표시
- Separator: 섹션 구분선
- Toast (Sonner): 성공/에러 알림

[Source: docs/architecture.md - UI]

#### 컴포넌트 구조

```
app/notes/[id]/
├── page.tsx                 # 노트 상세 페이지 (AI 섹션 포함)
├── ai-section.tsx           # AI 섹션 컨테이너
├── summary-display.tsx      # 요약 표시 컴포넌트
├── tags-display.tsx         # 태그 표시 컴포넌트
├── generate-buttons.tsx     # 생성 버튼 컴포넌트
└── __tests__/
    └── ai-section.test.tsx  # 컴포넌트 테스트
```

#### Server Actions 사용

```typescript
'use client'

import { useState } from 'react'
import { generateSummary, getSummary, generateTags, getTags } from '@/app/notes/ai-actions'
import { toast } from 'sonner'

export function AiSection({ noteId }: { noteId: string }) {
  const [isLoading, setIsLoading] = useState(false)

  const handleGenerateSummary = async () => {
    setIsLoading(true)
    try {
      const result = await generateSummary(noteId)
      if (result.success) {
        toast.success('요약이 생성되었습니다')
      } else {
        toast.error(result.error)
      }
    } catch (error) {
      toast.error('요약 생성 중 오류가 발생했습니다')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div>
      <button onClick={handleGenerateSummary} disabled={isLoading}>
        {isLoading ? '생성 중...' : '요약 생성'}
      </button>
    </div>
  )
}
```

[Source: Next.js App Router - Client Components with Server Actions]

#### 상태 관리

**로컬 상태 관리 (useState)**:
- isLoadingSummary: 요약 생성 로딩 상태
- isLoadingTags: 태그 생성 로딩 상태
- summary: 요약 데이터
- tags: 태그 데이터
- error: 에러 메시지

**서버 상태 동기화**:
- Server Actions 호출 후 revalidatePath로 자동 업데이트
- 추가적인 상태 관리 라이브러리 불필요

[Source: Next.js Documentation - Server Actions]

#### 스타일링 가이드

**Tailwind CSS 클래스**:
```tsx
// 카드 레이아웃
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  <Card className="p-6">
    {/* 요약 내용 */}
  </Card>
  <Card className="p-6">
    {/* 태그 내용 */}
  </Card>
</div>

// 로딩 스피너
<Loader2 className="h-4 w-4 animate-spin" />

// 버튼
<Button disabled={isLoading}>
  {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
  {isLoading ? '생성 중...' : '요약 생성'}
</Button>

// 태그 뱃지
<Badge variant="secondary">{tag}</Badge>
```

[Source: shadcn/ui Documentation, Tailwind CSS]

#### 에러 처리 패턴

**에러 타입별 메시지 매핑**:
```typescript
function getErrorMessage(error: string): string {
  if (error.includes('네트워크')) {
    return '네트워크 연결을 확인해주세요'
  } else if (error.includes('시간')) {
    return '처리 시간이 초과되었습니다. 다시 시도해주세요'
  } else if (error.includes('권한')) {
    return '접근 권한이 없습니다'
  } else {
    return '요약 생성 중 오류가 발생했습니다'
  }
}
```

#### 성능 최적화

1. **지연 로딩**
   - AI 섹션은 노트 로드 후 표시
   - 초기 로드 성능 영향 최소화

2. **캐싱**
   - Server Actions의 revalidatePath 활용
   - 불필요한 리렌더링 방지

3. **낙관적 업데이트 (선택)**
   - 요약 생성 중에도 UI 반응성 유지

[Source: Next.js Performance Best Practices]

#### 접근성 고려사항

**ARIA 속성**:
```tsx
<button
  aria-label="AI로 노트 요약 생성"
  aria-busy={isLoading}
  disabled={isLoading}
>
  요약 생성
</button>

<div role="status" aria-live="polite">
  {isLoading && '요약 생성 중...'}
</div>
```

**키보드 네비게이션**:
- 모든 버튼은 Tab 키로 접근 가능
- Enter/Space 키로 클릭 가능
- 포커스 스타일 명확히 표시

[Source: WAI-ARIA Best Practices]

### 테스트 전략

#### 컴포넌트 테스트

**React Testing Library 사용**:
```typescript
import { render, screen, fireEvent, waitFor } from '@testing-library/react'
import { AiSection } from '../ai-section'

describe('AiSection', () => {
  it('요약이 있으면 표시한다', async () => {
    render(<AiSection noteId="test-note-id" />)
    
    await waitFor(() => {
      expect(screen.getByText(/요약 포인트/)).toBeInTheDocument()
    })
  })

  it('요약 생성 버튼 클릭 시 로딩 상태가 표시된다', async () => {
    render(<AiSection noteId="test-note-id" />)
    
    const button = screen.getByRole('button', { name: /요약 생성/ })
    fireEvent.click(button)
    
    expect(screen.getByText(/생성 중/)).toBeInTheDocument()
  })
})
```

#### 접근성 테스트

**axe-core 사용 (선택)**:
```typescript
import { axe, toHaveNoViolations } from 'jest-axe'

expect.extend(toHaveNoViolations)

it('접근성 위반이 없어야 한다', async () => {
  const { container } = render(<AiSection noteId="test-note-id" />)
  const results = await axe(container)
  expect(results).toHaveNoViolations()
})
```

[Source: Testing Library Documentation]

### UI/UX 디자인 원칙

1. **명확성**
   - 로딩, 성공, 에러 상태가 명확히 구분
   - 버튼 라벨이 직관적

2. **피드백**
   - 사용자 액션에 즉각적인 피드백
   - 토스트 알림으로 결과 전달

3. **일관성**
   - shadcn/ui 디자인 시스템 준수
   - 프로젝트 전체 스타일 가이드 따름

4. **효율성**
   - 전체 생성 버튼으로 한번에 처리 가능
   - 개별 생성 버튼으로 선택적 생성 가능

[Source: docs/prd.md - UI/UX 원칙]

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 최초 작성 | SM (Bob) |

---

## Dev Agent Record

### Agent Model Used

_Not yet assigned_

### Debug Log References

None

### Completion Notes List

_Not yet implemented_

### File List

_Not yet implemented_

---

## QA Results

_Not yet implemented_

