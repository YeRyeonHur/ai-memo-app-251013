# Story 2.3: 노트 상세 조회

## Status

Ready for Review

---

## Story

**As a** 사용자,  
**I want** 노트를 클릭하여 전체 내용을 상세히 보고 싶다,  
**so that** 노트의 전체 내용을 읽고 필요한 작업(수정, 삭제)을 수행할 수 있다.

---

## Acceptance Criteria

1. 노트 목록에서 노트 카드 클릭 시 노트 상세 페이지(`/notes/[id]`)로 이동해야 한다
2. 노트 상세 페이지는 다음 정보를 표시해야 한다
   - 노트 제목 (전체)
   - 노트 본문 (전체, 줄바꿈 유지)
   - 작성일시 (절대 시간: "2025년 1월 10일 오후 3:45")
   - 수정일시 (절대 시간)
3. 페이지 상단에 네비게이션 버튼들이 있어야 한다
   - "← 목록으로" 버튼 (노트 목록으로 돌아가기)
   - "수정" 버튼 (노트 수정 페이지로 이동)
   - "삭제" 버튼 (노트 삭제)
4. 노트가 존재하지 않거나 다른 사용자의 노트일 경우
   - "노트를 찾을 수 없습니다" 에러 메시지 표시
   - 404 페이지로 처리
5. 비인증 사용자는 노트 상세 페이지에 접근할 수 없어야 한다
   - middleware에서 로그인 페이지로 리다이렉트
6. 로딩 상태를 표시해야 한다
   - 노트 상세 정보 로딩 중 스켈레톤 UI
7. 본문의 줄바꿈과 공백이 유지되어야 한다
   - `white-space: pre-wrap` 또는 유사한 스타일 적용
8. 반응형으로 구현되어야 한다
   - 모바일에서도 읽기 편한 레이아웃

---

## Tasks / Subtasks

- [x] Task 1: 노트 상세 조회 Server Action 구현 (AC: 2, 4)
  - [x] `/app/notes/actions.ts`에 `getNoteById` 함수 추가
  - [x] 인증 사용자 확인 (getUser)
  - [x] Drizzle ORM으로 노트 단건 조회
    - [x] id와 user_id로 필터링 (소유자만 조회 가능)
    - [x] 노트가 없거나 권한이 없으면 null 반환
  - [x] 타입 정의 (GetNoteByIdResult)

- [x] Task 2: 노트 상세 페이지 구현 (AC: 1, 2, 3, 7, 8)
  - [x] `/app/notes/[id]/page.tsx` 생성 (Server Component)
  - [x] 동적 라우트 파라미터 읽기 (params.id)
  - [x] getNoteById Server Action 호출
  - [x] 노트 정보 표시
    - [x] 제목 (h1 태그)
    - [x] 작성일시, 수정일시 (format 함수 사용)
    - [x] 본문 (pre-wrap 스타일)
  - [x] 네비게이션 버튼
    - [x] "← 목록으로" 버튼
    - [x] "수정" 버튼
    - [x] "삭제" 버튼
  - [x] 반응형 레이아웃 (컨테이너, 패딩)

- [x] Task 3: 404 처리 및 에러 상태 (AC: 4)
  - [x] 노트를 찾을 수 없을 때 notFound() 함수 호출
  - [x] `/app/notes/[id]/not-found.tsx` 생성
  - [x] "노트를 찾을 수 없습니다" 메시지
  - [x] 목록으로 돌아가기 버튼

- [x] Task 4: 스켈레톤 로딩 UI 구현 (AC: 6)
  - [x] `/app/notes/[id]/loading.tsx` 생성
  - [x] 노트 상세 페이지 모양의 스켈레톤
  - [x] 제목, 메타 정보, 본문 영역 스켈레톤

- [x] Task 5: 날짜 포맷팅 유틸리티 (AC: 2)
  - [x] date-fns의 `format` 함수 사용
  - [x] "2025년 1월 10일 오후 3:45" 형식
  - [x] 한국어 locale 적용

- [x] Task 6: 삭제 확인 다이얼로그 (AC: 3)
  - [x] 삭제 버튼 클릭 시 확인 다이얼로그 표시
  - [x] "정말 삭제하시겠습니까?" 메시지
  - [x] 확인 시 deleteNote Server Action 호출 (2.5 스토리에서 구현)
  - [x] 일단 disabled로 임시 구현

- [x] Task 7: 테스트 작성
  - [x] `/app/notes/actions.test.ts`에 getNoteById 테스트 추가
    - [x] 인증 사용자가 자신의 노트 조회 성공
    - [x] 다른 사용자의 노트 조회 실패
    - [x] 존재하지 않는 노트 조회 시 null 반환
    - [x] 비인증 사용자는 조회 실패
  - [x] `/app/notes/[id]/__tests__/page.test.tsx` 생성 (선택적) - 스킵

---

## Dev Notes

### 이전 스토리 인사이트

[Source: docs/stories/2.2.story.md]
- 노트 목록 조회 및 페이지네이션 완료 (`getNotes` Server Action)
- 노트 카드 컴포넌트 구현 완료 (`NoteCard`)
- 노트 카드 클릭 시 `/notes/${note.id}` 경로로 이동하도록 이미 구현됨
- date-fns 라이브러리 설치 완료
- `truncateText` 유틸리티 함수 구현 완료

### 기술 스택

[Source: docs/architecture.md#1-기술-스택]
- **프레임워크**: Next.js (App Router, Server Actions)
- **UI**: shadcn/ui + Tailwind CSS + Radix UI
- **DB/인증**: Supabase (Postgres, Auth)
- **ORM**: Drizzle ORM

### 데이터 모델 (notes 테이블)

[Source: drizzle/schema.ts]
- **notes 테이블 스키마**:
  - `id`: UUID, primary key
  - `user_id`: UUID, not null
  - `title`: text, not null
  - `content`: text, not null
  - `created_at`: timestamp, 기본값 now()
  - `updated_at`: timestamp, 기본값 now()
- **TypeScript 타입**: `Note`, `NewNote`

### 서버 액션

[Source: docs/architecture.md#4-서버-액션]
- `getNoteById` – 노트 단건 조회 (이 스토리에서 구현)
- `deleteNote` – 노트 삭제 (2.5 스토리에서 구현)

### 보안 및 권한

[Source: docs/architecture.md#3-보안]
- **권한 스코프**: 노트는 사용자 ID 스코프로 소유자만 조회 가능
- **인증**: Supabase Auth 사용 (`getUser`로 현재 사용자 확인)
- 다른 사용자의 노트 접근 시도 시 404 처리

### Next.js 동적 라우트

- **동적 라우트**: `/app/notes/[id]/page.tsx`
- **파라미터 읽기**: `params.id`
- **notFound()**: 404 페이지 표시 함수
- **not-found.tsx**: 커스텀 404 페이지
- **loading.tsx**: 로딩 상태 페이지 (Suspense 자동 적용)

### 날짜 포맷팅

- **date-fns 사용**: `format(date, 'PPP p', { locale: ko })`
- **한국어 locale**: `import { ko } from 'date-fns/locale'`
- **예시 출력**: "2025년 1월 10일 오후 3:45"

### 본문 표시 스타일

- **줄바꿈 유지**: `white-space: pre-wrap` 또는 `whitespace-pre-wrap` 클래스
- **긴 단어 줄바꿈**: `break-words` 클래스
- **예시**: `<p className="whitespace-pre-wrap break-words">{content}</p>`

### 프로젝트 구조

[Source: project layout]
- **노트 상세 페이지**: `/app/notes/[id]/` 디렉토리
  - `/app/notes/[id]/page.tsx` - 노트 상세 페이지 (새로 생성)
  - `/app/notes/[id]/not-found.tsx` - 404 페이지 (새로 생성)
  - `/app/notes/[id]/loading.tsx` - 로딩 페이지 (새로 생성)
- **Server Actions**: `/app/notes/actions.ts` (getNoteById 추가)

### 파일 길이 제한

[Source: 프로젝트 규칙]
- 모든 파일은 **500 LOC 이하** 유지
- 파일은 모듈화되고 단일 목적을 가져야 함

### 주석 규칙

[Source: 프로젝트 규칙]
- 모든 파일은 **4줄의 헤더 주석**으로 시작:
  1. 코드베이스 내 정확한 파일 위치
  2. 이 파일이 무엇을 하는지 설명
  3. 이 파일이 왜 존재하는지 설명
  4. 관련된 2~4개 파일 목록

---

## Testing

### 테스트 표준

[Source: 프로젝트 규칙]
- **테스트 프레임워크**: Vitest
- **테스트 파일 위치**: `__tests__/` 디렉토리 또는 동일 위치에 `.test.ts`
- **테스트 커버리지 목표**: 80% 이상

### 테스트 항목

1. **Server Action 테스트** (`/app/notes/actions.test.ts`에 추가)
   - `getNoteById` 함수 유닛 테스트
   - 인증된 사용자가 자신의 노트 조회 성공
   - 다른 사용자의 노트 조회 시 null 반환
   - 존재하지 않는 노트 조회 시 null 반환
   - 비인증 사용자는 노트 조회 실패

2. **페이지 렌더링 테스트** (선택적)
   - 노트 상세 페이지가 올바르게 렌더링되는지 확인
   - 제목, 본문, 날짜가 표시되는지 확인
   - 버튼들이 올바르게 렌더링되는지 확인

---

## Change Log

| Date       | Version | Description              | Author     |
|------------|---------|--------------------------|------------|
| 2025-10-14 | 1.0     | Story 2.3 초안 작성      | Bob (SM)   |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

없음

### Completion Notes List

- getNoteById Server Action 구현 완료
- 노트 상세 페이지 구현 완료
- 404 및 로딩 페이지 구현 완료
- date-fns를 사용한 날짜 포맷팅 구현 완료
- 모든 테스트 통과 (108 tests passed)

### File List

- `app/notes/actions.ts` - getNoteById Server Action 추가
- `app/notes/[id]/page.tsx` - 노트 상세 페이지 (생성)
- `app/notes/[id]/not-found.tsx` - 404 페이지 (생성)
- `app/notes/[id]/loading.tsx` - 로딩 스켈레톤 (생성)
- `app/notes/actions.test.ts` - getNoteById 테스트 추가

---

## QA Results

_(QA 에이전트가 검토 후 작성)_

