# Story 2.6: 노트 정렬 옵션

## Status

Ready for Review

---

## Story

**As a** 사용자,  
**I want** 노트 목록을 다양한 기준으로 정렬하고 싶다,  
**so that** 원하는 방식으로 노트를 탐색하고 필요한 노트를 빠르게 찾을 수 있다.

---

## Acceptance Criteria

1. 노트 목록 페이지 상단에 정렬 옵션 선택 UI가 있어야 한다
   - 드롭다운 또는 버튼 그룹 형태
   - 현재 선택된 정렬 옵션이 명확히 표시되어야 함
2. 다음 정렬 옵션들이 제공되어야 한다
   - 최신순 (created_at DESC) - 기본값
   - 오래된순 (created_at ASC)
   - 제목순 (title ASC)
   - 최근 수정순 (updated_at DESC)
3. 정렬 옵션 변경 시
   - 노트 목록이 즉시 재정렬되어야 한다
   - URL에 정렬 파라미터가 반영되어야 한다 (예: `?sort=title-asc`)
   - 페이지가 새로고침되어도 정렬 옵션이 유지되어야 한다
4. 페이지네이션과 정렬이 함께 동작해야 한다
   - 정렬 변경 시 1페이지로 초기화
   - 페이지 이동 시 선택된 정렬 옵션 유지
5. 빈 노트 목록에서도 정렬 UI는 표시되어야 한다
   - 비활성화되지 않음
6. 반응형으로 구현되어야 한다
   - 모바일에서는 컴팩트한 드롭다운
   - 데스크톱에서는 버튼 그룹 또는 드롭다운
7. 정렬 옵션은 사용자별로 저장되지 않는다
   - 세션/로컬 스토리지 사용 안 함 (URL 기반만)

---

## Tasks / Subtasks

- [ ] Task 1: Server Action 수정 - 정렬 파라미터 지원 (AC: 2, 3, 4)
  - [ ] `/app/notes/actions.ts`의 `getNotes` 함수 수정
  - [ ] sortBy 파라미터 추가 (타입: 'newest' | 'oldest' | 'title' | 'updated')
  - [ ] Drizzle ORM orderBy 동적 적용
    - [ ] newest: desc(notes.createdAt)
    - [ ] oldest: asc(notes.createdAt)
    - [ ] title: asc(notes.title)
    - [ ] updated: desc(notes.updatedAt)
  - [ ] 타입 정의 업데이트 (SortOption)

- [ ] Task 2: 정렬 UI 컴포넌트 구현 (AC: 1, 6)
  - [ ] shadcn/ui `Select` 컴포넌트 설치
  - [ ] `/app/notes/sort-select.tsx` 생성 (Client Component)
  - [ ] 정렬 옵션 드롭다운
  - [ ] 현재 선택된 옵션 표시
  - [ ] 옵션 변경 시 URL 업데이트

- [ ] Task 3: 노트 목록 페이지 통합 (AC: 3, 4, 5)
  - [ ] `/app/notes/page.tsx` 수정
  - [ ] URL search params에서 sort 파라미터 읽기
  - [ ] SortSelect 컴포넌트 추가 (페이지 상단)
  - [ ] getNotes 호출 시 sort 파라미터 전달
  - [ ] 정렬 변경 시 page=1로 리셋

- [ ] Task 4: URL 상태 관리 (AC: 3, 4)
  - [ ] useSearchParams 또는 useRouter 사용
  - [ ] 정렬 옵션 변경 시 URL 업데이트
  - [ ] 기존 페이지 파라미터와 함께 동작
  - [ ] 브라우저 뒤로가기/앞으로가기 지원

- [ ] Task 5: 페이지네이션 컴포넌트 수정 (AC: 4)
  - [ ] `/app/notes/pagination.tsx` 수정
  - [ ] 페이지 변경 시 현재 정렬 옵션 유지
  - [ ] URL 파라미터에 sort도 포함

- [ ] Task 6: 반응형 디자인 (AC: 6)
  - [ ] 모바일: 전체 너비 드롭다운
  - [ ] 데스크톱: 컴팩트한 드롭다운 또는 버튼 그룹
  - [ ] 레이아웃에 맞게 배치

- [ ] Task 7: 테스트 작성
  - [ ] `/app/notes/actions.test.ts`에 getNotes 정렬 테스트 추가
    - [ ] newest 정렬 확인
    - [ ] oldest 정렬 확인
    - [ ] title 정렬 확인
    - [ ] updated 정렬 확인
    - [ ] 잘못된 sort 값 처리
  - [ ] 컴포넌트 테스트 (선택적)
    - [ ] SortSelect 렌더링 테스트
    - [ ] 옵션 변경 시 URL 업데이트 테스트

---

## Dev Notes

### 이전 스토리 인사이트

[Source: docs/stories/2.2.story.md]
- 노트 목록 조회 및 페이지네이션 구현 완료
- `getNotes` Server Action 구현 완료
- URL search params 기반 페이지네이션 구현 완료
- Pagination 컴포넌트 구현 완료

[Source: docs/stories/2.3.story.md, 2.4.story.md]
- date-fns 라이브러리 사용 중
- Server Action 패턴 정립 완료

### 기술 스택

[Source: docs/architecture.md#1-기술-스택]
- **프레임워크**: Next.js (App Router, Server Actions)
- **UI**: shadcn/ui + Tailwind CSS + Radix UI
- **DB/인증**: Supabase (Postgres, Auth)
- **ORM**: Drizzle ORM

### 데이터 모델 (notes 테이블)

[Source: drizzle/schema.ts]
- **notes 테이블 스키마**:
  - `id`: UUID, primary key
  - `user_id`: UUID, not null
  - `title`: text, not null
  - `content`: text, not null
  - `created_at`: timestamp, 기본값 now()
  - `updated_at`: timestamp, 기본값 now()

### 정렬 전략

- **URL 기반 상태 관리**: 정렬 옵션을 URL search params로 관리
  - 공유 가능한 URL
  - 브라우저 히스토리 지원
  - 페이지 새로고침 시에도 유지
- **기본 정렬**: 최신순 (created_at DESC)
- **정렬 옵션**:
  - `newest` → `desc(notes.createdAt)`
  - `oldest` → `asc(notes.createdAt)`
  - `title` → `asc(notes.title)`
  - `updated` → `desc(notes.updatedAt)`

### Drizzle ORM 동적 정렬 예시

```typescript
// 정렬 옵션에 따른 orderBy 동적 적용
let orderByClause

switch (sortBy) {
  case 'oldest':
    orderByClause = asc(notes.createdAt)
    break
  case 'title':
    orderByClause = asc(notes.title)
    break
  case 'updated':
    orderByClause = desc(notes.updatedAt)
    break
  case 'newest':
  default:
    orderByClause = desc(notes.createdAt)
}

const notesList = await db
  .select()
  .from(notes)
  .where(eq(notes.userId, user.id))
  .orderBy(orderByClause)
  .limit(pageSize)
  .offset(offset)
```

### shadcn/ui Select

- **설치**: `npx shadcn@latest add select`
- **사용 패턴**:
  - Select - 루트 컨테이너
  - SelectTrigger - 드롭다운 트리거 버튼
  - SelectValue - 현재 선택된 값 표시
  - SelectContent - 드롭다운 내용
  - SelectItem - 개별 옵션

### URL 파라미터 관리

```typescript
// URL 파라미터 읽기
const searchParams = useSearchParams()
const currentPage = parseInt(searchParams.get('page') || '1')
const currentSort = searchParams.get('sort') || 'newest'

// URL 파라미터 업데이트
const handleSortChange = (newSort: string) => {
  const params = new URLSearchParams(searchParams)
  params.set('sort', newSort)
  params.set('page', '1') // 정렬 변경 시 1페이지로
  router.push(`/notes?${params.toString()}`)
}
```

### 페이지네이션과 정렬 통합

- 페이지 변경 시: 현재 정렬 옵션 유지
- 정렬 변경 시: 1페이지로 초기화
- URL 예시:
  - `/notes?page=1&sort=newest`
  - `/notes?page=2&sort=title`
  - `/notes?page=3&sort=updated`

### 프로젝트 구조

[Source: project layout]
- **노트 목록 페이지**: `/app/notes/` 디렉토리
  - `/app/notes/page.tsx` - 노트 목록 페이지 (수정)
  - `/app/notes/sort-select.tsx` - 정렬 선택 컴포넌트 (새로 생성)
  - `/app/notes/pagination.tsx` - 페이지네이션 컴포넌트 (수정)
- **Server Actions**: `/app/notes/actions.ts` (getNotes 수정)

### 파일 길이 제한

[Source: 프로젝트 규칙]
- 모든 파일은 **500 LOC 이하** 유지
- 파일은 모듈화되고 단일 목적을 가져야 함

### 주석 규칙

[Source: 프로젝트 규칙]
- 모든 파일은 **4줄의 헤더 주석**으로 시작:
  1. 코드베이스 내 정확한 파일 위치
  2. 이 파일이 무엇을 하는지 설명
  3. 이 파일이 왜 존재하는지 설명
  4. 관련된 2~4개 파일 목록

### UX 고려사항

- 정렬 변경은 즉각적으로 반영
- 로딩 상태 표시 (선택적)
- 정렬 옵션은 명확하고 이해하기 쉬운 한국어 레이블
- 모바일에서 터치하기 쉬운 크기

---

## Testing

### 테스트 표준

[Source: 프로젝트 규칙]
- **테스트 프레임워크**: Vitest
- **테스트 파일 위치**: `__tests__/` 디렉토리 또는 동일 위치에 `.test.ts`
- **테스트 커버리지 목표**: 80% 이상

### 테스트 항목

1. **Server Action 테스트** (`/app/notes/actions.test.ts`에 추가)
   - `getNotes` 정렬 기능 유닛 테스트
   - newest 정렬 시 최신 노트가 먼저 반환
   - oldest 정렬 시 오래된 노트가 먼저 반환
   - title 정렬 시 알파벳순으로 반환
   - updated 정렬 시 최근 수정된 노트가 먼저 반환
   - 잘못된 sort 값은 기본값(newest)로 처리

2. **컴포넌트 테스트** (선택적)
   - SortSelect 컴포넌트 렌더링 확인
   - 옵션 변경 시 onChange 콜백 호출
   - 현재 선택된 옵션이 올바르게 표시

3. **통합 테스트** (선택적)
   - URL 파라미터와 정렬이 올바르게 연동
   - 페이지네이션과 정렬이 함께 동작

---

## Change Log

| Date       | Version | Description              | Author     |
|------------|---------|--------------------------|------------|
| 2025-10-14 | 1.0     | Story 2.6 초안 작성      | Bob (SM)   |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

없음

### Completion Notes List

- getNotes Server Action에 정렬 파라미터 지원 추가 (newest, oldest, title, updated)
- Select 컴포넌트를 사용한 정렬 선택 UI 구현 완료
- URL 기반 정렬 상태 관리 구현 완료
- 페이지네이션과 정렬 통합 완료
- 모든 정렬 옵션 테스트 통과 (117 tests passed)

### File List

- `components/ui/select.tsx` - Select 컴포넌트 (설치)
- `app/notes/actions.ts` - getNotes에 sortBy 파라미터 추가 및 동적 orderBy 구현
- `app/notes/sort-select.tsx` - 정렬 선택 컴포넌트 (생성)
- `app/notes/page.tsx` - SortSelect 통합 및 sort 파라미터 처리 (수정)
- `app/notes/actions.test.ts` - 정렬 기능 테스트 추가

---

## QA Results

_(QA 에이전트가 검토 후 작성)_

